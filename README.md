# EfDEnhanced - Escape from Duckov Enhancement Mod

**Enhanced raid experience with pre-raid checks and in-raid quest tracking**

Never die from forgetting your meds, ammo, or quest items again! Track your active quests in real-time during raids with a clean, non-intrusive HUD overlay.

---

## ç›®å‰åŠŸèƒ½ | Current Features

### ğŸ¯ ä»»åŠ¡è¿½è¸ª | Quest Tracking

åœ¨ä»»åŠ¡é¢æ¿ä¸­å¯ä»¥è¿½è¸ªä»»åŠ¡ï¼Œå¹¶åœ¨æ¸¸æˆä¸­äºå³ä¸Šè§’æ˜¾ç¤ºã€‚

Quests can be tracked in the quest panel, and will be displayed in the upper right corner of the game.

**åŠŸèƒ½ç‰¹æ€§ | Features:**
- **é€‰æ‹©æ€§è¿½è¸ª** | Selective Tracking - ä½¿ç”¨ä»»åŠ¡é¢æ¿ä¸­çš„å¤é€‰æ¡†é€‰æ‹©è¦è¿½è¸ªçš„ä»»åŠ¡
- **å±€å†…æ˜¾ç¤º** | In-Raid Display - ä»…è¿½è¸ªçš„ä»»åŠ¡ä¼šæ˜¾ç¤ºåœ¨å³ä¸Šè§’
- **åŸç”ŸUIé£æ ¼** | Native UI Style - ä½¿ç”¨æ¸¸æˆåŸç”Ÿä»»åŠ¡å›¾æ ‡å®ç°æ— ç¼é›†æˆ
- **è¿›åº¦è¿½è¸ª** | Progress Tracking - æ˜¾ç¤ºæ¯ä¸ªä»»åŠ¡çš„å®Œæˆ/æ€»æ•°ï¼ˆä¾‹å¦‚ "2/3"ï¼‰
- **ä»»åŠ¡çŠ¶æ€** | Task Status - âœ“ è¡¨ç¤ºå·²å®Œæˆï¼Œâ—‹ è¡¨ç¤ºå¾…å®Œæˆ
- **æŒä¹…åŒ–è®¾ç½®** | Persistent Settings - è¿½è¸ªåå¥½ä¼šåœ¨ä¼šè¯é—´ä¿å­˜
- **è‡ªåŠ¨æ˜¾éš** | Auto Show/Hide - ä»…åœ¨çªè¢­æ—¶å¯è§ï¼ŒåŸºåœ°ä¸­éšè—
- **å¤šè¯­è¨€æ”¯æŒ** | Multi-language - å®Œæ•´æ”¯æŒä¸­æ–‡ã€è‹±æ–‡å’Œæ—¥æ–‡

**ä½¿ç”¨æ–¹æ³• | How to use:**
1. æ‰“å¼€ä»»åŠ¡é¢æ¿ï¼ˆTab é”®ï¼‰| Open quest panel (Tab key)
2. ç‚¹å‡»ä»»æ„ä»»åŠ¡æŸ¥çœ‹è¯¦æƒ… | Click any quest to view details
3. å‹¾é€‰ä»»åŠ¡æ ‡é¢˜ä¸‹æ–¹çš„"å±€å†…è¿½è¸ª"å¤é€‰æ¡† | Check the "Track in Raid" checkbox below the quest title
4. è¿›å…¥çªè¢­ååœ¨å³ä¸Šè§’æŸ¥çœ‹è¿½è¸ªçš„ä»»åŠ¡ï¼| Enter raid and see your tracked quests in top-right corner!

---

### âœ… ä¼ é€å°è¿›å›¾æ£€æŸ¥ | Pre-Raid Checks

ä½¿ç”¨ä¼ é€å°è¿›å…¥åœ°å›¾å‰æ£€æŸ¥ï¼š

Before entering a map using the teleporter, check:

- âœ… **æ­¦å™¨æ£€æŸ¥** | Weapon - æ˜¯å¦æºå¸¦äº†æ­¦å™¨ï¼Ÿ| Are you carrying weapons?
- âœ… **å¼¹è¯æ£€æŸ¥** | Ammunition - æ˜¯å¦æºå¸¦äº†å¼¹è¯ï¼Ÿ| Are you carrying ammunition?
- âœ… **è¯å“æ£€æŸ¥** | Medicine - æ˜¯å¦æºå¸¦äº†è¯å“ï¼Ÿ| Are you carrying medicine?
- âœ… **é£Ÿç‰©æ£€æŸ¥** | Food/Drink - æ˜¯å¦æºå¸¦äº†é£Ÿç‰©ï¼Ÿ| Are you carrying food?
- âš ï¸ **å¤©æ°”æ£€æŸ¥** | Weather - æ˜¯å¦å¤„äºé£æš´å¤©æ°”ï¼Ÿ| Are you in a storm?
- âœ… **ä»»åŠ¡ç‰©å“æ£€æŸ¥** | Quest Items - æ˜¯å¦æºå¸¦äº†ä»»åŠ¡æ‰€éœ€çš„ç‰©å“ï¼Ÿ| Are you carrying the necessary items for the quest?
- âš ï¸ **é£æš´é¢„è­¦** | Storm Warning - æ˜¯å¦æœ‰å³å°†åˆ°æ¥çš„é£æš´ï¼Ÿ| Is a storm approaching within 24 hours?

**æ™ºèƒ½è­¦å‘Šå¯¹è¯æ¡† | Smart Warning Dialog:**

å¦‚æœæ£€æµ‹åˆ°ä»»ä½•é—®é¢˜ï¼Œä¼šæ˜¾ç¤ºæ¸…æ™°çš„å¯¹è¯æ¡†ï¼š

If any issues are detected, a clear dialog shows you:
- ç¼ºå°‘çš„è£…å¤‡å†…å®¹ï¼ˆå¸¦é¢œè‰²æ ‡è®°ï¼‰| What's missing from your loadout (color-coded)
- éœ€è¦çš„ä»»åŠ¡ç‰©å“ï¼ˆå¸¦ä»»åŠ¡åç§°ï¼‰| Which quest items you need (with quest names)
- å½“å‰å¤©æ°”çŠ¶å†µå’Œé£æš´è­¦å‘Š | Current weather conditions and storm warnings
- å¯é€‰æ‹©ç»§ç»­æˆ–è¿”å›å‡†å¤‡ | Option to continue anyway or go back to prepare

---

### ğŸ”§ æ— ç¼é›†æˆ | Seamless Integration

- é€‚ç”¨äºæ‰€æœ‰çªè¢­å…¥å£ï¼ˆä¼ é€å°ã€æ¥¼æ¢¯ã€ä¸‹æ°´é“ï¼‰| Works with all raid entry points
- ä½¿ç”¨æ¸¸æˆåŸç”Ÿç‰©å“æ£€æµ‹ç³»ç»Ÿä»¥ç¡®ä¿å‡†ç¡®æ€§ | Uses game's native item detection systems for accuracy
- å¤±æ•ˆä¿æŠ¤è®¾è®¡ï¼šå‡ºé”™æ—¶ä¸ä¼šé˜»æ­¢ä½  | Fail-safe design: won't block you if something goes wrong
- å®Œå…¨æœ¬åœ°åŒ–UIï¼ˆç®€ä½“ä¸­æ–‡ã€ç¹ä½“ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ï¼‰| Fully localized UI in Chinese Simplified, Traditional, English, and Japanese

---

æ›´å¤šåŠŸèƒ½ç­‰æˆ‘é‡åˆ°å¿ä¸äº†çš„é—®é¢˜å†è¯´å§... ğŸ˜„

More features will be added later when I encounter unbearable problems... ğŸ˜„

## Installation

1. Download the latest release
2. Extract to `Duckov_Data/Mods/EfDEnhanced/` (or `Duckov.app/Contents/Mods/` on macOS)
3. Launch game - mod loads automatically

## How It Works

### Usage

The mod runs automatically - no configuration needed!

1. Equip your gear and select a raid map
2. Click on a map entry to enter
3. If everything is ready: you'll enter immediately
4. If something is missing: a warning dialog appears

**In the warning dialog:**
- Press **Confirm** (Enter/Space/Gamepad A) to continue anyway
- Press **Cancel** (ESC/Gamepad B) to go back and prepare

### Item Detection

The mod uses the game's official item detection APIs:

- **Guns**: Uses `item.GetBool("IsGun")` marker
- **Ammo**: Uses `item.GetBool("IsBullet")` marker  
- **Medicine**: Checks for `Drug` behavior component
- **Food**: Checks for `FoodDrink` behavior component
- **Quest Items**: Reads `RequiredItemID` from active quests

This ensures compatibility with all vanilla items and most modded items that follow game conventions.

## Logging

View logs to troubleshoot or see what's being checked:

**Windows:**
```powershell
Get-Content "$env:USERPROFILE\AppData\LocalLow\TeamSoda\Duckov\Player.log" -Wait
```

**macOS:**
```bash
tail -f ~/Library/Logs/TeamSoda/Duckov/Player.log
```

**Or use the included script:**
```bash
./scripts/rlog.sh
```

**Example log output:**
```
[EfDEnhanced] [RaidCheck] Starting raid readiness check...
[EfDEnhanced] [RaidCheck] Found weapon: AK-47
[EfDEnhanced] [RaidCheck] Found ammo: 5.45x39 å¼¹è¯
[EfDEnhanced] [RaidCheck] Found medicine: æ€¥æ•‘åŒ…
[EfDEnhanced] [RaidCheck] Found food: ç½å¤´
[EfDEnhanced] [RaidCheck] Current weather: Sunny, Safe: True
[EfDEnhanced] [QuestCheck] Found 2 active quests
[EfDEnhanced] [QuestCheck] âœ“ Quest: è§£æ•‘äººè´¨, Item: é’¥åŒ™å¡, Required: 1, Current: 1
[EfDEnhanced] [RaidCheck] All checks passed, allowing entry
```

## Known Limitations

- Doesn't check if ammo matches your gun type
- Doesn't verify minimum quantities (just checks if you have any)
- Quest item checks only verify `RequiredItemID` (items you must bring)
- Doesn't check quest scene requirements (you might have items but wrong map)
- Doesn't check `SubmitItems` (items to find and turn in later)

## Technical Details

### Architecture

- **Built with**: .NET Standard 2.1, HarmonyLib 2.4.1
- **Game Framework**: Official Duckov.Modding API
- **Patches**: Runtime method interception on `MapSelectionView.NotifyEntryClicked`
- **UI**: Custom Unity UI integrated with game's view system

### Code Structure

```
EfDEnhanced/
â”œâ”€â”€ ModBehaviour.cs           # Mod entry point and initialization
â”œâ”€â”€ Patches/
â”‚   â””â”€â”€ RaidEntryPatches.cs  # Intercepts raid entry clicks
â”œâ”€â”€ Features/
â”‚   â”œâ”€â”€ ActiveQuestTracker.cs # In-raid quest tracker HUD (NEW!)
â”‚   â”œâ”€â”€ RaidCheckDialog.cs    # Warning dialog UI
â”‚   â””â”€â”€ RaidPreparationView.cs # Preparation screen view
â””â”€â”€ Utils/
    â”œâ”€â”€ RaidCheckUtility.cs   # Core check logic
    â”œâ”€â”€ LocalizationHelper.cs # Multi-language support
    â””â”€â”€ ModLogger.cs          # Logging utilities
```

## Development

### Building from Source

**Requirements:**
- Escape from Duckov installed

**Build steps:**
```bash
dotnet restore
dotnet build -c Release
```

The mod automatically deploys to your game's Mods folder on build.

### Contributing

Found a bug or have a feature request? Please open an issue on GitHub!

When reporting bugs, include:
- Your game version
- Mod version
- Relevant log excerpts
- Steps to reproduce

## License

This mod is provided as-is for Escape from Duckov modding community.

## Credits

Built with:
- [HarmonyLib](https://github.com/pardeike/Harmony) - Runtime patching
- [UniTask](https://github.com/Cysharp/UniTask) - Async operations
- [TrueShadow](https://github.com/LeaTai/TrueShadow) - High-quality UI shadows
- TextMeshPro - Advanced text rendering
- Duckov Modding Framework - Official mod API

---

**Support the mod:** If you find this useful, please star the repository and share with your squadmates!

